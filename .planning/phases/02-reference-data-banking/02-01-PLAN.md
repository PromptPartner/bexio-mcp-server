---
phase: 02-reference-data-banking
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/schemas/reference.ts
  - src/types/schemas/index.ts
  - src/tools/reference/definitions.ts
  - src/tools/reference/handlers.ts
  - src/tools/reference/index.ts
  - src/tools/index.ts
  - src/bexio-client.ts
autonomous: true

must_haves:
  truths:
    - "User can list and get contact groups"
    - "User can create and delete contact groups"
    - "User can list and get contact sectors"
    - "User can create contact sectors"
    - "User can list and get salutations"
    - "User can create and delete salutations"
    - "User can list and get titles"
    - "User can create and delete titles"
    - "User can list and get countries"
    - "User can create and delete countries"
    - "User can list and get languages"
    - "User can create languages"
    - "User can list and get units"
    - "User can create and delete units"
  artifacts:
    - path: "src/types/schemas/reference.ts"
      provides: "Zod schemas for all reference data tools"
      exports: ["ListContactGroupsParamsSchema", "CreateContactGroupParamsSchema", "DeleteContactGroupParamsSchema", "ListContactSectorsParamsSchema", "CreateContactSectorParamsSchema", "ListSalutationsParamsSchema", "CreateSalutationParamsSchema", "DeleteSalutationParamsSchema", "ListTitlesParamsSchema", "CreateTitleParamsSchema", "DeleteTitleParamsSchema", "ListCountriesParamsSchema", "CreateCountryParamsSchema", "DeleteCountryParamsSchema", "ListLanguagesParamsSchema", "CreateLanguageParamsSchema", "ListUnitsParamsSchema", "CreateUnitParamsSchema", "DeleteUnitParamsSchema"]
    - path: "src/tools/reference/definitions.ts"
      provides: "MCP tool definitions for reference data"
      min_lines: 100
    - path: "src/tools/reference/handlers.ts"
      provides: "Handler implementations for reference data tools"
      exports: ["handlers"]
    - path: "src/tools/reference/index.ts"
      provides: "Barrel export for reference domain"
      exports: ["toolDefinitions", "handlers"]
  key_links:
    - from: "src/tools/reference/handlers.ts"
      to: "src/bexio-client.ts"
      via: "client method calls"
      pattern: "client\\.(list|get|create|delete)(ContactGroup|ContactSector|Salutation|Title|Country|Language|Unit)"
    - from: "src/tools/index.ts"
      to: "src/tools/reference/index.ts"
      via: "import and spread"
      pattern: "import.*reference.*from.*reference"
---

<objective>
Implement reference data tools for contact groups, sectors, salutations, titles, countries, languages, and units.

Purpose: Provide foundational configuration data that contacts, invoices, and other entities depend on. These reference lists are used throughout Bexio for categorization and formatting.

Output:
- 28 new MCP tools (4 contact groups + 3 contact sectors + 4 salutations + 4 titles + 4 countries + 3 languages + 4 units + 2 getters per type)
- New `tools/reference/` domain module
- New `types/schemas/reference.ts` schema file
- BexioClient methods for all reference data endpoints
</objective>

<execution_context>
@C:\Users\calvi\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\calvi\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-reference-data-banking/02-RESEARCH.md
@src/tools/contacts/definitions.ts
@src/tools/contacts/handlers.ts
@src/tools/index.ts
@src/types/schemas/contacts.ts
@src/types/schemas/index.ts
@src/bexio-client.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create reference data Zod schemas and BexioClient methods</name>
  <files>
    src/types/schemas/reference.ts
    src/types/schemas/index.ts
    src/bexio-client.ts
  </files>
  <action>
Create `src/types/schemas/reference.ts` with Zod schemas for all reference data operations. Follow the existing pattern from `contacts.ts`.

Schemas needed (each with corresponding type export):

**Contact Groups (REFDATA-01):**
- `ListContactGroupsParamsSchema`: { limit?: number, offset?: number }
- `GetContactGroupParamsSchema`: { group_id: number }
- `CreateContactGroupParamsSchema`: { name: string }
- `DeleteContactGroupParamsSchema`: { group_id: number }

**Contact Sectors (REFDATA-02):**
- `ListContactSectorsParamsSchema`: { limit?: number, offset?: number }
- `GetContactSectorParamsSchema`: { sector_id: number }
- `CreateContactSectorParamsSchema`: { name: string }

**Salutations (REFDATA-03):**
- `ListSalutationsParamsSchema`: { limit?: number, offset?: number }
- `GetSalutationParamsSchema`: { salutation_id: number }
- `CreateSalutationParamsSchema`: { name: string }
- `DeleteSalutationParamsSchema`: { salutation_id: number }

**Titles (REFDATA-04):**
- `ListTitlesParamsSchema`: { limit?: number, offset?: number }
- `GetTitleParamsSchema`: { title_id: number }
- `CreateTitleParamsSchema`: { name: string }
- `DeleteTitleParamsSchema`: { title_id: number }

**Countries (REFDATA-05):**
- `ListCountriesParamsSchema`: { limit?: number, offset?: number }
- `GetCountryParamsSchema`: { country_id: number }
- `CreateCountryParamsSchema`: { name: string, iso_3166_alpha2: string (2 chars) }
- `DeleteCountryParamsSchema`: { country_id: number }

**Languages (REFDATA-06):**
- `ListLanguagesParamsSchema`: { limit?: number, offset?: number }
- `GetLanguageParamsSchema`: { language_id: number }
- `CreateLanguageParamsSchema`: { name: string, iso_639_1: string (2 chars) }

**Units (REFDATA-07):**
- `ListUnitsParamsSchema`: { limit?: number, offset?: number }
- `GetUnitParamsSchema`: { unit_id: number }
- `CreateUnitParamsSchema`: { name: string }
- `DeleteUnitParamsSchema`: { unit_id: number }

Update `src/types/schemas/index.ts` to export from `reference.ts`.

Add BexioClient methods for all reference data endpoints (add to `src/bexio-client.ts` before the `// ===== ORDERS =====` section):

```typescript
// ===== CONTACT GROUPS =====
async listContactGroups(params: PaginationParams = {}): Promise<unknown[]>
async getContactGroup(groupId: number): Promise<unknown>
async createContactGroup(data: { name: string }): Promise<unknown>
async deleteContactGroup(groupId: number): Promise<unknown>

// ===== CONTACT SECTORS =====
async listContactSectors(params: PaginationParams = {}): Promise<unknown[]>
async getContactSector(sectorId: number): Promise<unknown>
async createContactSector(data: { name: string }): Promise<unknown>

// ===== SALUTATIONS =====
async listSalutations(params: PaginationParams = {}): Promise<unknown[]>
async getSalutation(salutationId: number): Promise<unknown>
async createSalutation(data: { name: string }): Promise<unknown>
async deleteSalutation(salutationId: number): Promise<unknown>

// ===== TITLES =====
async listTitles(params: PaginationParams = {}): Promise<unknown[]>
async getTitle(titleId: number): Promise<unknown>
async createTitle(data: { name: string }): Promise<unknown>
async deleteTitle(titleId: number): Promise<unknown>

// ===== COUNTRIES =====
async listCountries(params: PaginationParams = {}): Promise<unknown[]>
async getCountry(countryId: number): Promise<unknown>
async createCountry(data: { name: string; iso_3166_alpha2: string }): Promise<unknown>
async deleteCountry(countryId: number): Promise<unknown>

// ===== LANGUAGES =====
async listLanguages(params: PaginationParams = {}): Promise<unknown[]>
async getLanguage(languageId: number): Promise<unknown>
async createLanguage(data: { name: string; iso_639_1: string }): Promise<unknown>

// ===== UNITS =====
async listUnits(params: PaginationParams = {}): Promise<unknown[]>
async getUnit(unitId: number): Promise<unknown>
async createUnit(data: { name: string }): Promise<unknown>
async deleteUnit(unitId: number): Promise<unknown>
```

API endpoints from Bexio docs:
- Contact groups: `/contact_group`
- Contact sectors: `/contact_sector`
- Salutations: `/salutation`
- Titles: `/title`
- Countries: `/country`
- Languages: `/language`
- Units: `/unit`
  </action>
  <verify>
    - `npx tsc --noEmit` compiles without errors
    - `grep -c "Schema" src/types/schemas/reference.ts` shows 19+ schemas
    - `grep -c "async" src/bexio-client.ts | head -1` shows increased method count
  </verify>
  <done>
    - All 19 Zod schemas created and exported
    - All 25 BexioClient methods added (list, get, create, delete as applicable)
    - TypeScript compiles successfully
  </done>
</task>

<task type="auto">
  <name>Task 2: Create reference domain tool definitions and handlers</name>
  <files>
    src/tools/reference/definitions.ts
    src/tools/reference/handlers.ts
    src/tools/reference/index.ts
    src/tools/index.ts
  </files>
  <action>
Create the `tools/reference/` domain following the established pattern from `tools/contacts/`.

**Create `src/tools/reference/definitions.ts`:**
Define 28 MCP tools (list, get, create, delete for each entity type):

Contact Groups (4 tools):
- `list_contact_groups` - List all contact groups with pagination
- `get_contact_group` - Get a specific contact group by ID
- `create_contact_group` - Create a new contact group (requires name)
- `delete_contact_group` - Delete a contact group by ID

Contact Sectors (3 tools):
- `list_contact_sectors` - List all contact sectors with pagination
- `get_contact_sector` - Get a specific contact sector by ID
- `create_contact_sector` - Create a new contact sector (requires name)
(Note: No delete for sectors per Bexio API)

Salutations (4 tools):
- `list_salutations` - List all salutations with pagination
- `get_salutation` - Get a specific salutation by ID
- `create_salutation` - Create a new salutation (requires name)
- `delete_salutation` - Delete a salutation by ID

Titles (4 tools):
- `list_titles` - List all titles with pagination
- `get_title` - Get a specific title by ID
- `create_title` - Create a new title (requires name)
- `delete_title` - Delete a title by ID

Countries (4 tools):
- `list_countries` - List all countries with pagination
- `get_country` - Get a specific country by ID
- `create_country` - Create a new country (requires name, iso_3166_alpha2)
- `delete_country` - Delete a country by ID

Languages (3 tools):
- `list_languages` - List all languages with pagination
- `get_language` - Get a specific language by ID
- `create_language` - Create a new language (requires name, iso_639_1)
(Note: No delete for languages per Bexio API)

Units (4 tools):
- `list_units` - List all units with pagination
- `get_unit` - Get a specific unit by ID
- `create_unit` - Create a new unit (requires name)
- `delete_unit` - Delete a unit by ID

Each tool definition follows the same pattern as contacts:
```typescript
{
  name: "list_contact_groups",
  description: "List all contact groups for categorizing contacts",
  inputSchema: {
    type: "object",
    properties: {
      limit: { type: "integer", description: "Max results (default: 100)", default: 100 },
      offset: { type: "integer", description: "Skip count (default: 0)", default: 0 },
    },
  },
}
```

**Create `src/tools/reference/handlers.ts`:**
Implement handlers for all 28 tools. Each handler:
1. Parses args with the corresponding Zod schema
2. Calls the appropriate BexioClient method
3. Returns the result

Follow the exact pattern from `tools/contacts/handlers.ts`.

**Create `src/tools/reference/index.ts`:**
Barrel export:
```typescript
export { toolDefinitions } from "./definitions.js";
export { handlers } from "./handlers.js";
```

**Update `src/tools/index.ts`:**
Add reference domain to imports and aggregation:
```typescript
import * as reference from "./reference/index.js";
// ...
const allDefinitions: Tool[] = [
  ...reference.toolDefinitions,  // 28 tools
  ...contacts.toolDefinitions,   // 7 tools
  // ... rest
];

const allHandlers: Record<string, HandlerFn> = {
  ...reference.handlers,
  ...contacts.handlers,
  // ... rest
};
```
  </action>
  <verify>
    - `npx tsc --noEmit` compiles without errors
    - `grep -c "name:" src/tools/reference/definitions.ts` shows 28+ (one per tool)
    - `grep -c ":" src/tools/reference/handlers.ts | head -1` shows handler entries
    - Tool count increased: `grep "toolDefinitions" src/tools/index.ts` shows reference added
  </verify>
  <done>
    - 28 tool definitions created in definitions.ts
    - 28 handlers implemented in handlers.ts
    - Barrel export in index.ts
    - Reference domain registered in tools/index.ts
    - Total tool count now 111 (83 + 28)
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify reference tools integration</name>
  <files>
    (verification only)
  </files>
  <action>
Verify the complete integration of reference data tools:

1. Build the project:
   ```bash
   npm run build
   ```

2. Check tool count matches expected:
   ```bash
   node -e "const {getAllToolDefinitions} = require('./dist/tools/index.js'); console.log('Total tools:', getAllToolDefinitions().length);"
   ```
   Expected: 111 tools (83 existing + 28 new reference tools)

3. Verify specific tools are registered:
   ```bash
   node -e "const {getHandler} = require('./dist/tools/index.js'); console.log('list_contact_groups:', !!getHandler('list_contact_groups')); console.log('create_country:', !!getHandler('create_country')); console.log('list_units:', !!getHandler('list_units'));"
   ```
   All should print `true`

4. Verify no console.log contamination:
   ```bash
   grep -r "console.log" src/tools/reference/ || echo "No console.log found (good)"
   ```

5. Check file sizes are under 200 lines:
   ```bash
   wc -l src/tools/reference/*.ts
   ```
  </action>
  <verify>
    - `npm run build` succeeds with no errors
    - Tool count is 111
    - All new handlers resolve correctly
    - No console.log in reference domain
    - All files under 200 lines
  </verify>
  <done>
    - Build passes
    - 111 tools registered
    - Reference tools accessible via getHandler
    - Code follows all project conventions
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` compiles successfully
2. 28 new reference data tools registered (111 total)
3. All handlers work with BexioClient methods
4. No TypeScript errors
5. No console.log statements
6. Files follow modular structure pattern
</verification>

<success_criteria>
- REFDATA-01: Contact groups tools (list, get, create, delete) implemented
- REFDATA-02: Contact sectors tools (list, get, create) implemented
- REFDATA-03: Salutations tools (list, get, create, delete) implemented
- REFDATA-04: Titles tools (list, get, create, delete) implemented
- REFDATA-05: Countries tools (list, get, create, delete) implemented
- REFDATA-06: Languages tools (list, get, create) implemented
- REFDATA-07: Units tools (list, get, create, delete) implemented
- All tools follow established domain module pattern
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-reference-data-banking/02-01-SUMMARY.md`
</output>
