---
phase: 02-reference-data-banking
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/schemas/company.ts
  - src/types/schemas/index.ts
  - src/tools/company/definitions.ts
  - src/tools/company/handlers.ts
  - src/tools/company/index.ts
  - src/tools/index.ts
  - src/bexio-client.ts
autonomous: true

must_haves:
  truths:
    - "User can view company profile"
    - "User can update company profile"
    - "User can list payment types"
    - "User can get a specific payment type"
    - "User can create payment types"
    - "User can list user permissions"
  artifacts:
    - path: "src/types/schemas/company.ts"
      provides: "Zod schemas for company and payments config tools"
      exports: ["GetCompanyProfileParamsSchema", "UpdateCompanyProfileParamsSchema", "ListPaymentTypesParamsSchema", "GetPaymentTypeParamsSchema", "CreatePaymentTypeParamsSchema", "ListPermissionsParamsSchema"]
    - path: "src/tools/company/definitions.ts"
      provides: "MCP tool definitions for company domain"
      min_lines: 40
    - path: "src/tools/company/handlers.ts"
      provides: "Handler implementations for company tools"
      exports: ["handlers"]
    - path: "src/tools/company/index.ts"
      provides: "Barrel export for company domain"
      exports: ["toolDefinitions", "handlers"]
  key_links:
    - from: "src/tools/company/handlers.ts"
      to: "src/bexio-client.ts"
      via: "client method calls"
      pattern: "client\\.(get|update)CompanyProfile|client\\.(list|get|create)PaymentType|client\\.listPermissions"
    - from: "src/tools/index.ts"
      to: "src/tools/company/index.ts"
      via: "import and spread"
      pattern: "import.*company.*from.*company"
---

<objective>
Implement company profile, permissions, and payment type configuration tools.

Purpose: Enable users to view and manage their Bexio company settings and payment configuration. These are foundational settings that affect invoicing and document generation.

Output:
- 6 new MCP tools (2 company profile + 1 permissions + 3 payment types)
- New `tools/company/` domain module
- New `types/schemas/company.ts` schema file
- BexioClient methods for company and payment type endpoints
</objective>

<execution_context>
@C:\Users\calvi\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\calvi\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-reference-data-banking/02-RESEARCH.md
@src/tools/contacts/definitions.ts
@src/tools/contacts/handlers.ts
@src/tools/index.ts
@src/types/schemas/contacts.ts
@src/bexio-client.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create company schemas and BexioClient methods</name>
  <files>
    src/types/schemas/company.ts
    src/types/schemas/index.ts
    src/bexio-client.ts
  </files>
  <action>
Create `src/types/schemas/company.ts` with Zod schemas for company profile, permissions, and payment types.

Schemas needed:

**Company Profile (REFDATA-09):**
- `GetCompanyProfileParamsSchema`: {} (empty, no params needed)
- `UpdateCompanyProfileParamsSchema`: { profile_data: z.record(z.unknown()) }

**Permissions (REFDATA-10):**
- `ListPermissionsParamsSchema`: {} (empty, no params needed)

**Payment Types (REFDATA-08):**
- `ListPaymentTypesParamsSchema`: { limit?: number, offset?: number }
- `GetPaymentTypeParamsSchema`: { payment_type_id: number }
- `CreatePaymentTypeParamsSchema`: { name: string }

Update `src/types/schemas/index.ts` to export from `company.ts`.

Add BexioClient methods (add after reference data methods, before ORDERS section):

```typescript
// ===== COMPANY PROFILE =====
async getCompanyProfile(): Promise<unknown> {
  return this.makeRequest("GET", "/company_profile");
}

async updateCompanyProfile(data: Record<string, unknown>): Promise<unknown> {
  return this.makeRequest("POST", "/company_profile", undefined, data);
}

// ===== PERMISSIONS =====
async listPermissions(): Promise<unknown> {
  return this.makeRequest("GET", "/permission");
}

// ===== PAYMENT TYPES =====
async listPaymentTypes(params: PaginationParams = {}): Promise<unknown[]> {
  return this.makeRequest("GET", "/payment_type", params);
}

async getPaymentType(paymentTypeId: number): Promise<unknown> {
  return this.makeRequest("GET", `/payment_type/${paymentTypeId}`);
}

async createPaymentType(data: { name: string }): Promise<unknown> {
  return this.makeRequest("POST", "/payment_type", undefined, data);
}
```

Note: Payment types and permissions are read-heavy. Payment types can be created but typically not deleted (Bexio constraint). Permissions endpoint is read-only.
  </action>
  <verify>
    - `npx tsc --noEmit` compiles without errors
    - `grep -c "Schema" src/types/schemas/company.ts` shows 6 schemas
    - `grep "getCompanyProfile\|listPermissions\|listPaymentTypes" src/bexio-client.ts` shows new methods
  </verify>
  <done>
    - All 6 Zod schemas created and exported
    - All 6 BexioClient methods added
    - TypeScript compiles successfully
  </done>
</task>

<task type="auto">
  <name>Task 2: Create company domain tool definitions and handlers</name>
  <files>
    src/tools/company/definitions.ts
    src/tools/company/handlers.ts
    src/tools/company/index.ts
    src/tools/index.ts
  </files>
  <action>
Create the `tools/company/` domain following the established pattern.

**Create `src/tools/company/definitions.ts`:**
Define 6 MCP tools:

Company Profile (2 tools):
- `get_company_profile` - Get the company profile information
  ```typescript
  {
    name: "get_company_profile",
    description: "Get the company profile including name, address, and settings",
    inputSchema: {
      type: "object",
      properties: {},
    },
  }
  ```
- `update_company_profile` - Update company profile settings
  ```typescript
  {
    name: "update_company_profile",
    description: "Update company profile settings",
    inputSchema: {
      type: "object",
      properties: {
        profile_data: {
          type: "object",
          description: "Profile fields to update",
        },
      },
      required: ["profile_data"],
    },
  }
  ```

Permissions (1 tool):
- `list_permissions` - List all user permissions
  ```typescript
  {
    name: "list_permissions",
    description: "List all available user permissions in the Bexio account",
    inputSchema: {
      type: "object",
      properties: {},
    },
  }
  ```

Payment Types (3 tools):
- `list_payment_types` - List all payment types with pagination
- `get_payment_type` - Get a specific payment type by ID
- `create_payment_type` - Create a new payment type (requires name)

**Create `src/tools/company/handlers.ts`:**
Implement handlers for all 6 tools:

```typescript
import { BexioClient } from "../../bexio-client.js";
import {
  GetCompanyProfileParamsSchema,
  UpdateCompanyProfileParamsSchema,
  ListPermissionsParamsSchema,
  ListPaymentTypesParamsSchema,
  GetPaymentTypeParamsSchema,
  CreatePaymentTypeParamsSchema,
} from "../../types/index.js";

export type HandlerFn = (
  client: BexioClient,
  args: unknown
) => Promise<unknown>;

export const handlers: Record<string, HandlerFn> = {
  get_company_profile: async (client, args) => {
    GetCompanyProfileParamsSchema.parse(args);
    return client.getCompanyProfile();
  },

  update_company_profile: async (client, args) => {
    const { profile_data } = UpdateCompanyProfileParamsSchema.parse(args);
    return client.updateCompanyProfile(profile_data);
  },

  list_permissions: async (client, args) => {
    ListPermissionsParamsSchema.parse(args);
    return client.listPermissions();
  },

  list_payment_types: async (client, args) => {
    const params = ListPaymentTypesParamsSchema.parse(args);
    return client.listPaymentTypes(params);
  },

  get_payment_type: async (client, args) => {
    const { payment_type_id } = GetPaymentTypeParamsSchema.parse(args);
    return client.getPaymentType(payment_type_id);
  },

  create_payment_type: async (client, args) => {
    const { name } = CreatePaymentTypeParamsSchema.parse(args);
    return client.createPaymentType({ name });
  },
};
```

**Create `src/tools/company/index.ts`:**
Barrel export:
```typescript
export { toolDefinitions } from "./definitions.js";
export { handlers } from "./handlers.js";
```

**Update `src/tools/index.ts`:**
Add company domain to imports and aggregation (after reference):
```typescript
import * as company from "./company/index.js";
// ...
const allDefinitions: Tool[] = [
  ...reference.toolDefinitions,  // 28 tools
  ...company.toolDefinitions,    // 6 tools
  ...contacts.toolDefinitions,   // 7 tools
  // ... rest
];

const allHandlers: Record<string, HandlerFn> = {
  ...reference.handlers,
  ...company.handlers,
  ...contacts.handlers,
  // ... rest
};
```
  </action>
  <verify>
    - `npx tsc --noEmit` compiles without errors
    - `grep -c "name:" src/tools/company/definitions.ts` shows 6 (one per tool)
    - `ls src/tools/company/` shows definitions.ts, handlers.ts, index.ts
    - `grep "company" src/tools/index.ts` shows import and usage
  </verify>
  <done>
    - 6 tool definitions created
    - 6 handlers implemented
    - Barrel export in index.ts
    - Company domain registered in tools/index.ts
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` compiles successfully
2. 6 new company/config tools registered
3. All handlers work with BexioClient methods
4. No TypeScript errors
5. No console.log statements
6. Files follow modular structure pattern
</verification>

<success_criteria>
- REFDATA-08: Payment types tools (list, get, create) implemented
- REFDATA-09: Company profile tools (get, update) implemented
- REFDATA-10: Permissions tools (list) implemented
- All tools follow established domain module pattern
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-reference-data-banking/02-02-SUMMARY.md`
</output>
