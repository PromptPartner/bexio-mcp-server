---
phase: 05-ui-packaging
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - manifest.json
  - icon.png
  - src/package.json
autonomous: true

must_haves:
  truths:
    - "MCPB bundle passes validation with mcpb validate"
    - "Bundle installs with double-click in Claude Desktop"
    - "User is prompted for API token on first run"
    - "Server starts correctly from bundle entry point"
  artifacts:
    - path: "manifest.json"
      provides: "MCPB bundle manifest for Claude Desktop installation"
      contains: "user_config"
    - path: "icon.png"
      provides: "Bundle icon for Claude Desktop"
      min_lines: 1
  key_links:
    - from: "manifest.json"
      to: "dist/index.js"
      via: "server.entry_point configuration"
      pattern: "dist/index.js"
    - from: "manifest.json"
      to: "user_config.api_token"
      via: "env variable interpolation"
      pattern: "\\$\\{user_config\\.api_token\\}"
---

<objective>
Create MCPB bundle with manifest.json for one-click Claude Desktop installation.

Purpose: Enable non-technical users to install the Bexio MCP server by double-clicking a .mcpb file, with automatic API token prompting and zero configuration.

Output: manifest.json, icon.png, and npm scripts for bundle creation and validation.
</objective>

<execution_context>
@C:\Users\calvi\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\calvi\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-ui-packaging/05-RESEARCH.md
@.planning/phases/05-ui-packaging/05-01-SUMMARY.md

# Current package structure
@src/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create manifest.json for MCPB bundle</name>
  <files>manifest.json</files>
  <action>
Create manifest.json at the project root (D:\AI\Bexio MCP v2\manifest.json) with:

```json
{
  "name": "bexio-mcp-server",
  "version": "2.0.0",
  "description": "Connect Claude Desktop to your Bexio accounting system. Manage invoices, contacts, projects, time tracking, and 200+ more tools through natural conversation.",
  "author": "Bexio MCP Contributors",
  "homepage": "https://github.com/bexio/mcp-server",
  "icon": "icon.png",
  "license": "MIT",
  "server": {
    "type": "node",
    "entry_point": "dist/index.js"
  },
  "mcp_config": {
    "command": "node",
    "args": ["dist/index.js"],
    "env": {
      "BEXIO_API_TOKEN": "${user_config.api_token}",
      "BEXIO_BASE_URL": "${user_config.base_url}"
    }
  },
  "user_config": {
    "api_token": {
      "type": "string",
      "title": "Bexio API Token",
      "description": "Your Bexio API token. Get it from Bexio > Settings > API Tokens. Required for authentication.",
      "required": true,
      "secret": true
    },
    "base_url": {
      "type": "string",
      "title": "API Base URL",
      "description": "Bexio API endpoint. Change only if using a custom endpoint.",
      "required": false,
      "default": "https://api.bexio.com/2.0"
    }
  },
  "compatibility": {
    "platforms": ["darwin", "win32", "linux"],
    "node_version": ">=18.0.0"
  },
  "capabilities": {
    "tools": true,
    "resources": true,
    "ui": true
  },
  "tools": [
    {
      "name": "list_invoices",
      "description": "List invoices with pagination and filtering",
      "annotations": { "readOnlyHint": true }
    },
    {
      "name": "preview_invoice",
      "description": "Display interactive invoice preview",
      "annotations": { "readOnlyHint": true }
    },
    {
      "name": "show_contact_card",
      "description": "Display formatted contact information",
      "annotations": { "readOnlyHint": true }
    },
    {
      "name": "show_dashboard",
      "description": "Display dashboard with invoice and contact summary",
      "annotations": { "readOnlyHint": true }
    },
    {
      "name": "list_contacts",
      "description": "List contacts with pagination",
      "annotations": { "readOnlyHint": true }
    },
    {
      "name": "create_invoice",
      "description": "Create a new invoice in Bexio",
      "annotations": { "readOnlyHint": false }
    }
  ]
}
```

Notes:
- tools array shows representative sample (6 of 218+) for directory listing
- user_config.api_token uses secret: true for secure prompting
- base_url has default so users don't need to configure it
- capabilities.ui: true declares MCP Apps support
  </action>
  <verify>cat manifest.json parses as valid JSON; jq .name returns "bexio-mcp-server"</verify>
  <done>manifest.json created with complete MCPB schema</done>
</task>

<task type="auto">
  <name>Task 2: Create bundle icon and packaging scripts</name>
  <files>icon.png, src/package.json</files>
  <action>
1. Create icon.png at project root:
   - Create a simple 512x512 PNG icon
   - Use a placeholder: solid color square with "B" letter
   - Can use ImageMagick if available: `convert -size 512x512 xc:#3B82F6 -gravity center -font Arial -pointsize 200 -fill white -annotate 0 "B" icon.png`
   - If ImageMagick not available, create a minimal valid PNG programmatically or use a placeholder comment noting icon needed

2. Install MCPB CLI globally (for development):
   - Add instructions comment in package.json about `npm install -g @anthropic-ai/mcpb`

3. Add packaging scripts to src/package.json:
   - "pack:mcpb": "npm run build && cd .. && mcpb pack"
   - "validate:mcpb": "cd .. && mcpb validate"
   - "clean": "rm -rf dist"
   - "prebuild": "npm run clean"

4. Add .mcpbignore file at project root to exclude dev files from bundle:
   Create .mcpbignore with:
   ```
   .git
   .planning
   .claude
   .env
   .env.example
   mcp_bexio-main-v1
   node_modules
   src
   *.md
   !README.md
   tsconfig.json
   vite.config.ts
   .mcpbignore
   nul
   ```
  </action>
  <verify>icon.png exists (even as placeholder); npm run validate:mcpb shows no errors (or acceptable warnings)</verify>
  <done>Icon created, packaging scripts added, ignore patterns configured</done>
</task>

<task type="auto">
  <name>Task 3: Test bundle creation and validation</name>
  <files>None (verification only)</files>
  <action>
1. Build the project:
   cd src && npm run build

2. Validate manifest:
   cd .. && mcpb validate

   Expected: No errors (warnings OK for optional fields)

3. Create test bundle:
   mcpb pack

   Expected: Creates bexio-mcp-server-2.0.0.mcpb file

4. Verify bundle contents (mcpb is a ZIP):
   - Should contain: manifest.json, icon.png, dist/
   - Should NOT contain: src/, node_modules/, .planning/

5. Clean up test bundle:
   rm bexio-mcp-server-2.0.0.mcpb

Note: If mcpb CLI not available, document installation steps and mark as manual verification needed. The pack command requires the CLI to be installed globally.
  </action>
  <verify>mcpb validate exits with 0 or only warnings; .mcpb file can be created</verify>
  <done>Bundle validation passes, pack creates valid .mcpb file</done>
</task>

</tasks>

<verification>
1. manifest.json valid: `cat manifest.json | jq .` succeeds
2. Icon exists: `ls icon.png` returns file
3. Scripts work: `cd src && npm run pack:mcpb` completes (if mcpb CLI installed)
4. Ignore patterns: .mcpb file excludes src/, .planning/, node_modules/
</verification>

<success_criteria>
- manifest.json exists at project root with valid MCPB schema
- user_config defines api_token (secret: true) and base_url (with default)
- icon.png exists (placeholder acceptable for MVP)
- src/package.json has pack:mcpb and validate:mcpb scripts
- .mcpbignore excludes development files from bundle
- mcpb validate passes (or shows only warnings for optional fields)
</success_criteria>

<output>
After completion, create `.planning/phases/05-ui-packaging/05-02-SUMMARY.md`
</output>
