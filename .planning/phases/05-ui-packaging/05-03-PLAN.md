---
phase: 05-ui-packaging
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/package.json
  - src/index.ts
autonomous: true

must_haves:
  truths:
    - "npm package runs correctly via npx @bexio/mcp-server"
    - "Entry point has shebang for direct execution"
    - "Package includes correct files array for publishing"
    - "Bin field enables global CLI installation"
  artifacts:
    - path: "src/package.json"
      provides: "npm package configuration for CLI distribution"
      contains: "bin"
    - path: "src/index.ts"
      provides: "Entry point with shebang for npx execution"
      contains: "#!/usr/bin/env node"
  key_links:
    - from: "src/package.json:bin"
      to: "dist/index.js"
      via: "CLI binary mapping"
      pattern: "bexio-mcp-server.*dist/index.js"
---

<objective>
Configure package.json for npm publishing with npx support and proper distribution setup.

Purpose: Enable technical users to run the server via `npx @bexio/mcp-server` without manual installation, and allow global installation via `npm install -g`.

Output: Updated package.json with bin field, files array, and publish configuration.
</objective>

<execution_context>
@C:\Users\calvi\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\calvi\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-ui-packaging/05-RESEARCH.md

# Current package
@src/package.json
@src/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure package.json for npm publishing</name>
  <files>src/package.json</files>
  <action>
Update src/package.json with npm publishing configuration:

1. Change package name to scoped format:
   "name": "@bexio/mcp-server"

   Note: Verify scope availability before actual publish. Alternative: "bexio-mcp-server" if scope unavailable.

2. Add bin field for CLI execution:
   "bin": {
     "bexio-mcp-server": "dist/index.js"
   }

3. Add files array to control what gets published:
   "files": [
     "dist",
     "README.md",
     "LICENSE"
   ]

4. Add repository field:
   "repository": {
     "type": "git",
     "url": "https://github.com/bexio/mcp-server.git"
   }

5. Add prepublishOnly script (ensure build before publish):
   "prepublishOnly": "npm run build"

6. Add keywords for discoverability:
   "keywords": [
     "mcp",
     "bexio",
     "api",
     "typescript",
     "model-context-protocol",
     "claude",
     "accounting",
     "invoices",
     "swiss"
   ]

7. Ensure publishConfig for scoped packages (public access):
   "publishConfig": {
     "access": "public"
   }

8. Add homepage and bugs fields:
   "homepage": "https://github.com/bexio/mcp-server#readme",
   "bugs": {
     "url": "https://github.com/bexio/mcp-server/issues"
   }

Final package.json should have these top-level fields in order:
- name, version, description
- main, type, bin
- files, scripts
- repository, homepage, bugs
- keywords, license
- dependencies, devDependencies, engines
- publishConfig
  </action>
  <verify>npm pack --dry-run shows only dist/, README.md, LICENSE in package contents</verify>
  <done>package.json configured for npm publishing with bin and files fields</done>
</task>

<task type="auto">
  <name>Task 2: Ensure shebang in entry point</name>
  <files>src/index.ts</files>
  <action>
Verify src/index.ts starts with shebang:

1. Check first line is: #!/usr/bin/env node
   - This is ALREADY present based on earlier file read
   - Verify it's the FIRST line (no blank lines before it)

2. Verify shebang survives TypeScript compilation:
   - Run npm run build
   - Check dist/index.js starts with #!/usr/bin/env node
   - If shebang is stripped, add tsconfig.json option or post-build script

3. If shebang is stripped by tsc:
   Add to package.json scripts:
   "postbuild": "echo '#!/usr/bin/env node' | cat - dist/index.js > temp && mv temp dist/index.js"

   Or use sed (Windows compatible):
   "postbuild": "node -e \"const fs=require('fs'); const content=fs.readFileSync('dist/index.js','utf8'); if(!content.startsWith('#!')) fs.writeFileSync('dist/index.js', '#!/usr/bin/env node\\n'+content)\""

Note: The src/index.ts already has the shebang. This task verifies it persists through build.
  </action>
  <verify>head -1 dist/index.js shows "#!/usr/bin/env node"</verify>
  <done>Entry point has shebang that persists after TypeScript compilation</done>
</task>

<task type="auto">
  <name>Task 3: Create LICENSE and verify npm pack</name>
  <files>LICENSE</files>
  <action>
1. Create LICENSE file at src/LICENSE (or project root if preferred):
   Use MIT License text:
   ```
   MIT License

   Copyright (c) 2024 Bexio MCP Contributors

   Permission is hereby granted, free of charge, to any person obtaining a copy
   of this software and associated documentation files (the "Software"), to deal
   in the Software without restriction, including without limitation the rights
   to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
   copies of the Software, and to permit persons to whom the Software is
   furnished to do so, subject to the following conditions:

   The above copyright notice and this permission notice shall be included in all
   copies or substantial portions of the Software.

   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
   AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
   OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
   SOFTWARE.
   ```

2. Create minimal README.md at src/README.md for npm package:
   ```markdown
   # @bexio/mcp-server

   MCP server for Bexio accounting integration with Claude Desktop.

   ## Installation

   ### Via npx (recommended)
   ```bash
   npx @bexio/mcp-server
   ```

   ### Global installation
   ```bash
   npm install -g @bexio/mcp-server
   bexio-mcp-server
   ```

   ### Claude Desktop Configuration
   Add to your Claude Desktop config:
   ```json
   {
     "mcpServers": {
       "bexio": {
         "command": "npx",
         "args": ["@bexio/mcp-server"],
         "env": {
           "BEXIO_API_TOKEN": "your-token-here"
         }
       }
     }
   }
   ```

   ## Environment Variables

   - `BEXIO_API_TOKEN` (required): Your Bexio API token
   - `BEXIO_BASE_URL` (optional): API base URL (default: https://api.bexio.com/2.0)

   ## License

   MIT
   ```

3. Test npm pack:
   cd src && npm pack --dry-run

   Verify output shows:
   - dist/index.js
   - dist/...other compiled files
   - README.md
   - LICENSE
   - package.json

   Should NOT show:
   - src/
   - node_modules/
   - .planning/
  </action>
  <verify>npm pack --dry-run shows expected files; LICENSE exists; README.md has installation instructions</verify>
  <done>LICENSE and README.md created; npm pack shows correct contents</done>
</task>

</tasks>

<verification>
1. Build succeeds: `cd src && npm run build`
2. Shebang present: `head -1 dist/index.js` shows #!/usr/bin/env node
3. Pack contents: `npm pack --dry-run` shows only dist/, README.md, LICENSE, package.json
4. Bin works: After build, `node dist/index.js --help` (or starts server)
</verification>

<success_criteria>
- package.json has name "@bexio/mcp-server" (or fallback if scope unavailable)
- bin field maps "bexio-mcp-server" to "dist/index.js"
- files array includes ["dist", "README.md", "LICENSE"]
- publishConfig.access is "public"
- dist/index.js has shebang as first line after build
- LICENSE file exists with MIT text
- README.md has installation instructions for npx and global install
- npm pack --dry-run shows only intended files
</success_criteria>

<output>
After completion, create `.planning/phases/05-ui-packaging/05-03-SUMMARY.md`
</output>
